<mat-accordion>
  <mat-expansion-panel class="visual-settings-panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon class="visual-settings-panel-icon">view_headline</mat-icon>
        Visual settings
      </mat-panel-title>
    </mat-expansion-panel-header>

    <ng-template matExpansionPanelContent>
      <mat-toolbar color="primary">
        Toggle visible attributes
      </mat-toolbar>
      <mat-card>
        <mat-card-title>
          Node attributes
        </mat-card-title>
        <mat-card-content>
          <mat-selection-list #nodeAttrList
                              dense
                              (selectionChange)="nodeService.toggleAttr($event.option.value); nodeService.updateNodeLabel(nodes)">
            <mat-list-option *ngFor="let nodeAttr of nodeService.visibleAttrs"
                             color="primary"
                             [selected]="nodeService.activeAttrs.indexOf(nodeAttr) > -1"
                             [value]="nodeAttr">
              Show {{ (nodeAttr | titlecase).split('-').join(' ') }} ({{ abbreviateAttrLabel(nodeAttr) }})
            </mat-list-option>
          </mat-selection-list>
        </mat-card-content>
      </mat-card>
      <mat-card>
        <mat-card-title>
          Link attributes
        </mat-card-title>
        <mat-card-content>
          <mat-selection-list #linkAttrList
                              dense
                              (selectionChange)="linkService.toggleAttr($event.option.value); linkService.updateLinkLabel(links)">
            <mat-list-option *ngFor="let linkAttr of linkService.visibleAttrs"
                             color="primary"
                             [selected]="linkService.activeAttrs.indexOf(linkAttr) > -1"
                             [value]="linkAttr">
              Show {{ (linkAttr | titlecase).split('-').join(' ') }} ({{ abbreviateAttrLabel(linkAttr) }})
            </mat-list-option>
          </mat-selection-list>
        </mat-card-content>
      </mat-card>
      <mat-toolbar color="primary">
        Miscellaneous visualization attributes
      </mat-toolbar>
      <mat-card>
        <mat-card-title>
          Visualization depth
        </mat-card-title>
        <mat-card-content>
          <div>
            From root ({{ visualDepthFromRoot }}):
            <mat-icon (click)="visualDepthFromRoot = visualDepthFromRoot - (visualDepthFromRoot > 0)"
                      [style.cursor]="visualDepthFromRoot <= 0 ? 'not-allowed' : 'pointer'"
                      class="depth-visualization-control-icon">
              {{ visualDepthFromRoot > 0 ? 'remove_circle' : 'remove_circle_outlined' }}
            </mat-icon>
            <mat-slider [min]="0"
                        [max]="maxDepth - visualDepthFromLeaves"
                        [disabled]="maxDepth ? visualDepthFromLeaves === maxDepth : false"
                        [(value)]="visualDepthFromRoot"
                        step="1"
                        color="primary"
                        class="depth-visualization-slider">
            </mat-slider>
            <mat-icon (click)="visualDepthFromRoot = visualDepthFromRoot + (visualDepthFromRoot < maxDepth - visualDepthFromLeaves)"
                      [style.cursor]="visualDepthFromRoot >= (maxDepth - visualDepthFromLeaves) ? 'not-allowed' : 'pointer'"
                      class="depth-visualization-control-icon">
              {{ visualDepthFromRoot < maxDepth - visualDepthFromLeaves ? 'add_circle' : 'add_circle_outlined' }}
            </mat-icon>
          </div>
          <div>
            From leaf ({{ visualDepthFromLeaves }}):
            <mat-icon (click)="visualDepthFromLeaves = visualDepthFromLeaves - (visualDepthFromLeaves > 0)"
                      [style.cursor]="visualDepthFromLeaves <= 0 ? 'not-allowed' : 'pointer'"
                      class="depth-visualization-control-icon">
              {{ visualDepthFromLeaves > 0 ? 'remove_circle' : 'remove_circle_outlined' }}
            </mat-icon>
            <mat-slider [min]="0"
                        [max]="maxDepth - visualDepthFromRoot"
                        [disabled]="maxDepth ? visualDepthFromRoot === maxDepth : false"
                        [(value)]="visualDepthFromLeaves"
                        step="1"
                        color="primary"
                        class="depth-visualization-slider">
            </mat-slider>
            <mat-icon (click)="visualDepthFromLeaves = visualDepthFromLeaves + (visualDepthFromLeaves < maxDepth - visualDepthFromRoot)"
                      [style.cursor]="visualDepthFromLeaves >= (maxDepth - visualDepthFromRoot) ? 'not-allowed' : 'pointer'"
                      class="depth-visualization-control-icon">
              {{ visualDepthFromLeaves < maxDepth - visualDepthFromRoot ? 'add_circle' : 'add_circle_outlined' }}
            </mat-icon>
          </div>
          <div>
            Current tree depth: {{ maxDepth }}
          </div>
          <div>
            Visiblity of current tree: {{ (visualDepthFromLeaves + visualDepthFromRoot) / maxDepth | percent }}
          </div>
        </mat-card-content>
      </mat-card>
    </ng-template>
  </mat-expansion-panel>
</mat-accordion>

<mat-card>
  <mat-card-actions>
    <div>
      <mat-form-field class="current-tree-selector" *ngIf="treeNodes && treeNodes.length > 1">
        <mat-label class="forest-label">
          Current selected model from the forest (of size {{ treeNodes.length }}) to visualize:
        </mat-label>
        <mat-select [(ngModel)]="chosenTree" (ngModelChange)="changesHandler()">
          <mat-option *ngFor="let tree of treeNodes; index as i;"
                  value="{{ i }}">
                  {{ i + 1 }} (node count: {{ tree.tree_.value.node_count }}, depth: {{ tree.tree_.value.maximum_depth }})
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card-actions>
  
  <mat-card-content>
    <svg width="100%" height="512" class="current-tree-model"></svg>
  </mat-card-content>
  
  <mat-card-footer>
    <div>
      <span class="control-section-rotate">
        <mat-icon (click)="rotateTree(90)"
                  [style.cursor]="'pointer'"
                  class="rotate-icon">
          rotate_left
        </mat-icon>
        <mat-icon (click)="rotateTree(270)"
                  [style.cursor]="'pointer'"
                  class="rotate-icon">
          rotate_right
        </mat-icon>
      </span>
      <span class="control-section-zoom">
        <mat-icon (click)="updateZoomValue(-0.25)"
                  (dblclick)="updateZoomValue(-0.75)"
                  [style.cursor]="zoomValue <= zoomMin ? 'not-allowed' : 'pointer'"
                  class="zoom-icon">
          zoom_out
        </mat-icon>
        <mat-slider [min]="zoomMin"
                    [max]="zoomMax"
                    [(value)]="zoomValue"
                    step="0.01"
                    class="zoom-slider">
        </mat-slider>
        <mat-icon (click)="updateZoomValue(+0.25)"
                  (dblclick)="updateZoomValue(+0.75)"
                  [style.cursor]="zoomValue >= zoomMax ? 'not-allowed' : 'pointer'"
                  class="zoom-icon">
          zoom_in
        </mat-icon>
      </span>
    </div>
    
    <div *ngIf="treeNodes && (chosenTree || chosenTree === 0)">
      <mat-card>
        <mat-card-title>
          Current tree characteristics
        </mat-card-title>
    
        <mat-card-content>
          <mat-list>
            <span *ngFor="let attr of treeNodes[+chosenTree].tree_.value | keyvalue">
              <mat-list-item *ngIf="!attr.value.length">
                <strong>
                  {{ (attr.key | titlecase).split('_').join(' ') }}:
                </strong>
                {{ attr.value }}
              </mat-list-item>
            </span>
          </mat-list>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-card-footer>
</mat-card>
