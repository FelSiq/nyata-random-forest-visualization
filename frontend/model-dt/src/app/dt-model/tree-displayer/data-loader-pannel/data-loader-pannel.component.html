<mat-card *ngIf="calledPredictService || predictResults">
  <mat-card-title>
    Prediction results
  </mat-card-title>
  <mat-card-content *ngIf="predictResults; else waitingPredictionResults">
    <app-iterable-displayer [data]="predictResults" [banList]="predicResultsBanAttrs"></app-iterable-displayer>
  </mat-card-content>

  <ng-template #waitingPredictionResults>
    <mat-spinner class="waiting-spinner"></mat-spinner>
  </ng-template>
</mat-card>

<mat-accordion>
  <mat-expansion-panel>
    <mat-expansion-panel-header
          matTooltip="Create a single custom test instance for predictions with the current model.">
      <mat-panel-title>
        Custom test instance
      </mat-panel-title>
    </mat-expansion-panel-header>
  
    <ng-template matExpansionPanelContent>
      <form (ngSubmit)="predictTestInstValues()" [formGroup]="testInstForm">
        <div>
          <mat-form-field
              class="text-field-full-width"
              hideRequiredMarker="true"
              floatLabel="never">
            <input matInput
                   type="text"
                   formControlName="attrs"
                   placeholder="Test instance attribute values"
                   (input)="validateTestInstAttr()"
                   required>
          </mat-form-field>
        </div>
  
        <div class="form-separator-section">
          <mat-label> Attributes separator: </mat-label>
      
          <mat-radio-group
                (change)="validateTestInstAttr()"
                matTooltip="Select the symbol used to separate each attribute of the test instance"
                formControlName="sep"
                required>
            <mat-radio-button *ngFor="let sepOpt of sepOptions" value="{{ sepOpt.symb }}">
              {{ sepOpt.label }}
            </mat-radio-button>
            <mat-radio-button [value]="testInstForm.value.customSep">
              <mat-form-field
                  class="text-field-tiny-width"
                  floatLabel="never">
                <input matInput
                       formControlName="customSep"
                       placeholder="Custom"
                       type="text">
              </mat-form-field>
            </mat-radio-button>
          </mat-radio-group>
        </div>
      
        <mat-action-row>
          <button mat-raised-button
                  matTooltip="Use the current model to make predictions"
                  color="accent"
                  class="predict-button"
                  type="submit"
                  [style.cursor]="testInstForm.valid ? 'default' : 'not-allowed'"
                  [disabled]="testInstForm.invalid">
            {{
              testInstForm.valid ? "Predict" : (
              "Current instance dimension: " +
              (testInstForm.value.attrs ?
                testInstForm.value.attrs.split(testInstForm.value.sep).length : 0 ) +
              "/" + datasetDim)
            }}
          </button>
        </mat-action-row>
      </form>
    </ng-template>
  </mat-expansion-panel>
  
  <mat-expansion-panel>
    <mat-expansion-panel-header
          matTooltip="Load your own test dataset to make predictions with the current model.">
      <mat-panel-title>
        Load test dataset
      </mat-panel-title>
    </mat-expansion-panel-header>
  
    <ng-template matExpansionPanelContent>
      <p> Please note that the dataset file must be smaller than {{ maxFileSize }} {{ maxFileSizeUnit }}. </p>
      <label for="file-upload-input"> Choose your file: </label>
      <input type="file"
             id="file-upload-input"
             (change)="handleFileInput($event.target.files)"/>
      <mat-action-row>
        <button mat-raised-button> Submit </button>
      </mat-action-row>
    </ng-template>
  </mat-expansion-panel>
</mat-accordion>
